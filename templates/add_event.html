

<h1>{#title_add_event#}</h1>
<form action="{$SCRIPT_NAME}?action=add_event" method="post">
    <div>
        <label for="title">title</label><input type="text" name="title" id="title">{$ERROR_TITLE}
    </div>
    <div>
        <label for="suggestions">label</label><input type="text" name="input_label" id="input_label" autocomplete="off">
        <div id="suggestions_label">
        </div>
        <div id="selected_label"></div>
    </div>
   <div>
       description:<textarea name="description" id="description" cols="30" rows="10"></textarea>{$ERROR_DESCRIPTION}
   </div> 
    <div>
        <input type="checkbox" name="fixed_date" id="fixed_date"checked> <label for="fixed_date">fixes Datum</label>
    </div>
    <div>
        <input type="date" name="start_date" id="start_date">
        <input type="time" name="start_time" id="">
    </div>
    <div>
        <input type="checkbox" name="fixed_location" id="fixed_location" checked>fixer Ort
        
    </div>  
    <div>
        Ort: <input type="text" name="location" id="location">
    </div>
    <div>
        <input type="checkbox" name="limited_number_of_participants" id="limited_number_of_participants" checked>begrenzte Teilnehmeranzahl
    </div>
    <div>
        number_of_participants:<input type="number" name="max_number_of_participants" id="max_number_of_participants">
    </div>
    <div>
        <input type="checkbox" name="advance_reservation_required" id="advance_reservation_required" checked>advance_reservation_required
    </div>
    <div>
        <input type="checkbox" name="confirm_reservations" id="confirm_reservations" >confirm_reservations
    </div>
    <input type="submit" value="create event"> 
    
</form>

{include file="templates/modules/template_label.html"}

<p id='test'></p>

<script src="templates/main.js"></script>
<script>
    var input_label = document.getElementById('input_label');
    var input_fixed_date = document.getElementById('fixed_date');
    var input_start_date = document.getElementById('start_date');
    var input_fixed_location = document.getElementById('fixed_location');
    var input_location = document.getElementById('location');
    var input_limited_number_of_participants = document.getElementById('limited_number_of_participants');
    var input_max_number_of_participants = document.getElementById('max_number_of_participants');
    var input_advance_reservation_required = document.getElementById('advance_reservation_required');
    var input_confirm_reservations = document.getElementById('confirm_reservations');

    var array_selected_label = []; 

    input_fixed_date.addEventListener('click', function() {
        if (input_fixed_date.checked) {
            input_start_date.parentNode.style.display = "block";
        } else {
            input_start_date.parentNode.style.display = "none";
        }
    });

    input_fixed_location.addEventListener('click', function() {
        if (input_fixed_location.checked) {
            input_location.parentNode.style.display = "block";
        } else {
            input_location.parentNode.style.display = "none";
        }
    });

    input_limited_number_of_participants.addEventListener('click', function() {
        if (input_limited_number_of_participants.checked) {
            input_max_number_of_participants.parentNode.style.display = "block";
        } else {
            input_max_number_of_participants.parentNode.style.display = "none";
        }
    });

    input_advance_reservation_required.addEventListener("click", function() {
        if (input_advance_reservation_required.checked) {
            input_confirm_reservations.parentNode.style.display = "block";
        } else {
            input_confirm_reservations.parentNode.style.display = "none";
        }
    })

    input_label.addEventListener("keyup", function() {
       requestSuggestions();
    });
    
    function requestSuggestions() {
        var exclude = JSON.stringify(array_selected_label);
        ajax_request('./ajax.php?action=get_label&lang={$CURRENT_LANG}&q=' + input_label.value + '&exclude=' + exclude, displayLabel); 
    }

    function displayLabel(xhttp) {
        
        var div_suggestions_label = document.getElementById("suggestions_label");
        var temp_div = document.createElement("div");
        var suggestions = JSON.parse(xhttp.responseText);
        var entry;
        
        if (suggestions.error != null) {
            entry = document.createElement("div");
            entry.innerHTML = suggestions.error;
            temp_div.appendChild(entry);
        } else {
            suggestions.forEach(element => {
                var translation = element['translation'];
                entry = document.createElement("div");
                entry.innerHTML = translation;
                entry.addEventListener("click", function() {                   
                    selectLabel(translation, element['label_id']);
                    requestSuggestions();
                })
                temp_div.appendChild(entry);
            });
        }
        div_suggestions_label.replaceChild(temp_div, div_suggestions_label.firstChild);
    }

    function selectLabel(translation, label_id) {
        array_selected_label.push(label_id);
        var div_suggestions_label = document.getElementById("selected_label");
        var template = document.getElementById("template_label");
        var clon = template.content.cloneNode(true);

        
        clon.querySelectorAll("span")[0].innerHTML = translation;
        clon.querySelectorAll("span")[1].addEventListener("click", function() {
            removeSelectedLabel(this,label_id);
        });
        clon.querySelectorAll("input")[0].value = 3;
        div_suggestions_label.appendChild(clon);
    }

    function removeSelectedLabel(node,label_id) {
        node.parentNode.parentNode.removeChild(node.parentNode);
        var index = array_selected_label.indexOf(label_id);
        array_selected_label.splice(index,1);
        requestSuggestions();
    }

    // selectLabel(this)
</script>
